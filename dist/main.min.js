;(function() {
    let openBurgerMenu = document.querySelector(".hamburger");
    let burgerMenu = document.querySelector(".burger-menu");
    let closeBurgerMenu = document.querySelector(".burger-menu__close");
    let burgerMenuLink = document.querySelectorAll(".burger-menu__link");
    
    openBurgerMenu.addEventListener("click", (e) => {
      e.preventDefault();
      burgerMenu.classList.add("burger-menu-active");
    });
    
    burgerMenuLink.forEach(item => {
      item.addEventListener("click", (e) => {
        burgerMenuLink.forEach(link => {
          link.classList.remove("burger-link-active");
        });
    
        item.classList.add("burger-link-active")
        if (item.classList.contains("burger-link-active")) {
          burgerMenu.classList.remove("burger-menu-active");
        }
      });
    });
    
    closeBurgerMenu.addEventListener("click", (e) => {
      e.preventDefault();
      burgerMenu.classList.remove("burger-menu-active");
    });
    })()
    
    
    
    // $(".hamburger").on("click", function (event) {
    //   $('.burger-menu').addClass("burger-menu-active");
    // });
    
    // $(".burger-menu__close").on("click", function (event) {
    //   $('.burger-menu').removeClass("burger-menu-active");
    // });
    
    // $(".burger-item").on("click", function (event) {
    //   $('.burger-menu').removeClass("burger-menu-active");
    // });;//jquery
const mesureWidth = item => {
    let reqItemWidth = 0;
  
    const screenWidth = $(window).width();
    const container = item.closest(".menu-acco__list");
    const titlesBlocks = container.find(".menu-acco__button");
    const titlesWidth = titlesBlocks.width() * titlesBlocks.length;
  
    const textContainer = item.find(".menu-acco__desc");
    const paddingLeft = parseInt(textContainer.css("padding-left"));
    const paddingRight = parseInt(textContainer.css("padding-right"));
  
    const isMobile = window.matchMedia("(max-width: 786px)").matches;
  
    if (isMobile) {
      reqItemWidth = screenWidth - titlesWidth;
    } else {
      reqItemWidth = 500;
    }
  
    return {
      container: reqItemWidth,
      textContainer: reqItemWidth - paddingRight - paddingLeft
    }
  };
  
  const closeEveryItemInContainer = container => {
    const items = container.find(".menu-acco__item");
    const content = container.find(".menu-acco__content");
  
    items.removeClass("active");
    content.width(0);
  }
  
  const openItem = (item) => {
    const hiddenContent = item.find(".menu-acco__content");
    const reqWidth = mesureWidth(item);
    const textBlock = item.find(".menu-acco__desc");
  
    item.addClass("active");
    hiddenContent.width(reqWidth.container);
    textBlock.width(reqWidth.textContainer);
  }
  
  $(".menu-acco__button").on("click", e => {
    e.preventDefault();
  
    const $this = $(e.currentTarget);
    const item = $this.closest(".menu-acco__item");
    const itemOpened = item.hasClass("active");
    const container = $this.closest(".menu-acco__list");
  
    if (itemOpened) {
      closeEveryItemInContainer(container)
    } else {
      closeEveryItemInContainer(container)
      openItem(item);
    }
  });
  
  
  //js 
  // const menu = document.querySelector("#horizontalMenu");
  // const items = document.querySelectorAll(".menu-acco__item");
  
  // const getItemWidth = (item) => {
  //   let resultWidth = 524;
  //   const windowWidth = window.innerWidth;
  //   const itemWidth = item.offsetWidth;
  
  //   const isTablet = window.matchMedia("(max-width: 768px)").matches;
  //   const isMobile = window.matchMedia("(max-width: 480px)").matches;
  
  //   if (isTablet) {
  //     resultWidth = windowWidth - itemWidth * items.length;
  //   }
  
  //   if (isMobile) {
  //     resultWidth = windowWidth - itemWidth;
  //   }
  
  //   return resultWidth;
  // };
  
  // const setItemWidth = (item, width) => {
  //   const itemContent = item.nextElementSibling;
  //   const itemText = itemContent.firstElementChild;
  //   itemContent.style.width = `${width}px`;
  //   itemText.style.width = `${width}px`;
  // };
  
  // const closeItem = (item) => {
  //   const itemParent = item.parentElement;
  //   itemParent.classList.remove("menu-acco__item--active");
  //   item.classList.remove("menu-acco__button--active");
  //   setItemWidth(item, 0);
  // };
  
  // const openItem = (item) => {
  //   const itemParent = item.parentElement;
  //   itemParent.classList.add("menu-acco__item--active");
  //   item.classList.add("menu-acco__button--active");
  //   const width = getItemWidth(item);
  //   setItemWidth(item, width);
  // };
  
  // menu.addEventListener("click", (e) => {
  //   e.preventDefault();
  //   const target = e.target;
  //   const isActive = target.classList.contains("menu-acco__button--active");
  //   const activeElement = document.querySelector(".menu-acco__button--active");
  
  //   if (target.classList.contains("menu-acco__button") && isActive) {
  //     if (activeElement) {
  //       closeItem(activeElement);
  //     }
  //   }
  //   if (target.classList.contains("menu-acco__button") && !isActive) {
  //     if (activeElement) {
  //       closeItem(activeElement);
  //     }
  //     openItem(target);
  //   }
  // });
  
  // window.addEventListener("resize", () => {
  //   const activeButton = document.querySelector(".menu-acco__button--active");
  //   if (activeButton) {
  //     closeItem(activeButton);
  //   }
  // });;;let myMap;
const init = () => {
 myMap = new ymaps.Map("map", {
  center: [55.752004, 37.576133],
   zoom: 16,
   controls: [],
 });
 
 let coords = [
     [55.752004, 37.576133],
   ],
   myCollection = new ymaps.GeoObjectCollection({}, {
     draggable: false,
     iconLayout: 'default#image',
     iconImageHref: './img/icons/geo.svg',
     iconImageSize: [58, 73],
     iconImageOffset: [-35, -52]
   });
 
 for (let i = 0; i < coords.length; i++) {
   myCollection.add(new ymaps.Placemark(coords[i]));
 }
 
 myMap.geoObjects.add(myCollection);
 
 myMap.behaviors.disable('scrollZoom');
};
 
ymaps.ready(init);;const validateFields = (form, fieldsArray) => {
 
    fieldsArray.forEach((field) => {
      field.removeClass("input-error");
      if (field.val().trim() === "") {
        field.addClass("input-error");
      }
    });
  
    const errorFields = form.find(".input-error");
  
    return errorFields.length === 0;  
  }
  
  $(".form").submit(e => {
    e.preventDefault();
  
    const form = $(e.currentTarget);
    const name = form.find("[name='name']");
    const phone = form.find("[name='phone']");
    const comment = form.find("[name='comment']");
    const to = form.find("[name='to']");
  
    const modal = $("#modal");
    const content = modal.find(".modal__content");
  
    modal.removeClass("error-modal");
  
    const isValid = validateFields(form, [name, phone, comment, to]);
  
    if (isValid) {
      const request = $.ajax({
        url: "https://webdev-api.loftschool.com/sendmail",
        method: "post",
        data: {
          name: name.val(),
          phone: phone.val(),
          comment: comment.val(),
          to: to.val(),
        },
      });
  
      request.done(data => {
        content.text(data.message)
        modal.addClass("success-modal");
      });
  
      request.fail(data => {
        const message = data.responseJSON.message;
        content.text(message);
        modal.addClass("error-modal");
      });
  
      request.always(() => {
        $.fancybox.open({
          src: "#modal",
          type: "inline",
          smallBtn: false
        });
      });
    }
  });
  
  $(".app-submit-btn").click(e => {
    e.preventDefault();
  
    $.fancybox.close();
  });;(function() {
    const sections = $("section");
    const display = $(".maincontent");
    const sideMenu = $(".fixed-menu");
    const menuItems = sideMenu.find(".fixed-menu__item");
    
    const mobileDetect = new MobileDetect(window.navigator.userAgent);
    const isMobile = mobileDetect.mobile();
    
    
    let inScroll = false;
    
    sections.first().addClass("active");
    
    const countSectionPosition = sectionEq => {
      const position = sectionEq * -100;
    
      if (isNaN(position)) {
        console.error("передано неверное значение в countSectionPosition");
        return 0;
      }
    
      return position;
    }
    
    const changeMenuThemeForSection = sectionEq => {
      const currentSection = sections.eq(sectionEq);
      const menuTheme = currentSection.attr("data-sidemenu-theme");
      const sideMenuLink = $(".fixed-menu__link");
      const activeClass = ("fixed-menu--shadowed");
    
    
      if (menuTheme === "black") {
        sideMenu.addClass(activeClass),
          sideMenuLink.addClass("fixed-menu__link--shadowed");
      } else {
        sideMenu.removeClass("fixed-menu--shadowed"),
          sideMenuLink.removeClass("fixed-menu__link--shadowed");
      }
    }
    
    const resetActiveClassForItem = (items, itemEq, activeClass) => {
      items.eq(itemEq).addClass(activeClass).siblings().removeClass(activeClass);
    }
    
    const performTransition = (sectionEq) => {
      if (inScroll) return;
    
      const transitionOver = 1000;
      const mouseInertiaOver = 0;
    
      inScroll = true;
    
      const position = countSectionPosition(sectionEq);
    
      changeMenuThemeForSection(sectionEq);
    
      display.css({
        transform: `translateY(${position}%)`,
      });
    
      resetActiveClassForItem(sections, sectionEq, "active");
    
      setTimeout(() => {
        inScroll = false;
    
        resetActiveClassForItem(menuItems, sectionEq, "fixed-menu__item--active");
      }, transitionOver + mouseInertiaOver);
    
    };
    
    const viewportScroller = () => {
      const activeSection = sections.filter(".active");
      const nextSection = activeSection.next();
      const prevSection = activeSection.prev();
    
      return {
        next() {
          if (nextSection.length) {
            performTransition(nextSection.index());
          }
        },
        prev() {
          if (prevSection.length) {
            performTransition(prevSection.index());
          }
        },
      };
    };
    
    $(window).on("wheel", (e) => {
      const deltaY = e.originalEvent.deltaY;
      const scroller = viewportScroller();
    
      if (deltaY > 0) {
        scroller.next();
      }
    
      if (deltaY < 0) {
        scroller.prev();
      }
    });
    
    $(window).on("keydown", (e) => {
      const tagName = e.target.tagName.toLowerCase();
      const userTypingInInputs = tagName === "input" || tagName === "textarea";
      const scroller = viewportScroller();
    
      if (userTypingInInputs) return;
    
      switch (e.keyCode) {
        case 38:
          scroller.prev();
          break;
    
        case 40:
          scroller.next();
          break;
      }
    });
    
    $(".wrapper").on("touchmove", e => e.preventDefault());
    
    $("[data-scroll-to]").click((e) => {
      e.preventDefault();
    
      const $this = $(e.currentTarget);
      const target = $this.attr("data-scroll-to");
      const reqSection = $(`[data-section-id=${target}]`);
    
      performTransition(reqSection.index());
    });
    
    if (isMobile) {
    //https://github.com/mattbryson/TouchSwipe-Jquery-Plugin
    
    $("body").swipe({
      swipe: function (event, direction) {
        const scroller = viewportScroller();
        let scrollDirection = "";
        
        if (direction === "up") scrollDirection = "next";
        if (direction === "down") scrollDirection = "prev";
    
        if (scrollDirection) {
          scroller[scrollDirection]();
        }
      },
    });
    }
    })();;(function() {
    const findBlockByAlias = (alias) => {
      return $(".review__item").filter((ndx, item) => {
        return $(item).attr("data-linked-with") === alias;
      });
    };
    
    $(".interactive-avatar__link").click((e) => {
      e.preventDefault();
    
      const $this = $(e.currentTarget);
      const target = $this.attr("data-open");
      const itemToShow = findBlockByAlias(target);
      const curItem = $this.closest(".review__switcher-item",".interactive-avatar");
    
      itemToShow.addClass("review__item--active").siblings().removeClass("review__item--active");
      curItem.addClass("interactive-avatar--active").siblings().removeClass("interactive-avatar--active");
    });
    })();;(function() {
    const slider = $('.products__list').bxSlider({
      pager: false,
      controls: false,
    });
    
    $(".products__arrow--prev").click((e) => {
      e.preventDefault();
      slider.goToPrevSlide();
    });
    
    $(".products__arrow--next").click((e) => {
      e.preventDefault();
      slider.goToNextSlide();
    });
    })();;(function() {
    const openItem = item => {
      const container = item.closest(".team__item");
      const contentBlock = container.find(".team__content");
      const textBlock = contentBlock.find(".team__content-block"); 
      const reqHeight = textBlock.height();
      const svgIcon = container.find(".team__icon-img");
      const colorText = container.find(".team__name");
    
      container.addClass("active");
      svgIcon.addClass("team__icon-img--active");
      colorText.addClass("team__name--color");
      contentBlock.height(reqHeight);
    }
    
    const closeEveryItem = container => {
      const items = container.find(".team__content");
      const itemContainer = container.find(".team__item");
      const itemSvgIcon = container.find(".team__icon-img");
      const itemColorText = container.find(".team__name");
    
      itemContainer.removeClass("active");
      itemSvgIcon.removeClass("team__icon-img--active");
      itemColorText.removeClass("team__name--color");
      items.height(0);
    }
    
    $(".team__button").click(e => {
      const $this = $(e.currentTarget);
      const container = $this.closest(".team__list");
      const elemContainer = $this.closest(".team__item");
    
      if (elemContainer.hasClass("active")) {
        closeEveryItem(container);
      } else {
        closeEveryItem(container);
        openItem($this);
      }
    });
    })();let player;

const formatTime = timeSec => {
  const roundTime = Math.round(timeSec);

  const minutes = Math.floor(roundTime / 60);
  const seconds = roundTime - minutes * 60;

  const formattedSeconds = seconds < 10 ? `0${seconds}` : seconds;

  return `${minutes}:${formattedSeconds}`;
};

const onPlayerReady = () => {
  let interval;
  let durationSec = player.getDuration();

  $(".player__duration-estimate").text(formatTime(durationSec));

  if (typeof interval !== "undefined") {
    clearInterval(interval);
  }

  interval = setInterval(() => {
    const completedSec = player.getCurrentTime();
    const completedPercent = (completedSec / durationSec) * 100;

    $(".player__playback-button").css({
      left: `${completedPercent}%`
    });

    $(".player__duration-completed").text(formatTime(completedSec));
  }, 1000);
};

const eventsInit = () => {
  $(".player__start").on("click", e => {
    e.preventDefault();
    const btn = $(e.currentTarget);

    if (btn.hasClass("paused")) {
      player.pauseVideo();
    } else {
      player.playVideo();
    }
  });

  $(".player__playback").on("click", e => {
    const bar = $(e.currentTarget);
    const newButtonPosition = e.pageX - bar.offset().left;
    const buttonPosPercent = (newButtonPosition / bar.width()) * 100;
    const newPlayerTimeSec = (player.getDuration() / 100) * buttonPosPercent;

    $(".player__playback-button").css({
      left: `${buttonPosPercent}%`
    });

    player.seekTo(newPlayerTimeSec);
  });

  $(".player__splash").on("click", e => {
    player.playVideo();
  });
};

const onPlayerStateChange = event => {
  const playerButton = $(".player__start");
  /*
  -1 (воспроизведение видео не начато)
  0 (воспроизведение видео завершено)
  1 (воспроизведение)
  2 (пауза)
  3 (буферизация)
  5 (видео подают реплики).
   */
  switch (event.data) {
    case 1: 
      $('.player__wrapper').addClass('active');
      playerButton.addClass("paused");
      break;
    case 2: 
      playerButton.removeClass("paused");
      break;
  }
};

function onYouTubeIframeAPIReady() {
  player = new YT.Player("yt-player", {
    height: "405",
    width: "660",
    videoId: "7AkbUfZjS5k",
    events: {
      onReady: onPlayerReady,
      onStateChange: onPlayerStateChange
    },
    playerVars: {
      controls: 0,
      disablekb: 0,
      showinfo: 0,
      rel: 0,
      autoplay: 0,
      modestbranding: 0
    }
  });
}

eventsInit();
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImJ1cmdlci1tZW51LmpzIiwiaG9yaXpvbnRhbC1hY2NvLmpzIiwibWFpbi5qcyIsIm1hcC5qcyIsIm1vZGFsLmpzIiwib3BzLmpzIiwicmV2aWV3cy5qcyIsInNsaWRlci5qcyIsInRlYW0uanMiLCJ2aWRlby5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxXQzFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0NuSUEsQ0NBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLG1CQzVCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtDbkVBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNDdEpBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNDbEJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBLFNDZkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsU0N2Q0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSIsImZpbGUiOiJtYWluLm1pbi5qcyIsInNvdXJjZXNDb250ZW50IjpbIjsoZnVuY3Rpb24oKSB7XHJcbiAgICBsZXQgb3BlbkJ1cmdlck1lbnUgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLmhhbWJ1cmdlclwiKTtcclxuICAgIGxldCBidXJnZXJNZW51ID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5idXJnZXItbWVudVwiKTtcclxuICAgIGxldCBjbG9zZUJ1cmdlck1lbnUgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLmJ1cmdlci1tZW51X19jbG9zZVwiKTtcclxuICAgIGxldCBidXJnZXJNZW51TGluayA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoXCIuYnVyZ2VyLW1lbnVfX2xpbmtcIik7XHJcbiAgICBcclxuICAgIG9wZW5CdXJnZXJNZW51LmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoZSkgPT4ge1xyXG4gICAgICBlLnByZXZlbnREZWZhdWx0KCk7XHJcbiAgICAgIGJ1cmdlck1lbnUuY2xhc3NMaXN0LmFkZChcImJ1cmdlci1tZW51LWFjdGl2ZVwiKTtcclxuICAgIH0pO1xyXG4gICAgXHJcbiAgICBidXJnZXJNZW51TGluay5mb3JFYWNoKGl0ZW0gPT4ge1xyXG4gICAgICBpdGVtLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoZSkgPT4ge1xyXG4gICAgICAgIGJ1cmdlck1lbnVMaW5rLmZvckVhY2gobGluayA9PiB7XHJcbiAgICAgICAgICBsaW5rLmNsYXNzTGlzdC5yZW1vdmUoXCJidXJnZXItbGluay1hY3RpdmVcIik7XHJcbiAgICAgICAgfSk7XHJcbiAgICBcclxuICAgICAgICBpdGVtLmNsYXNzTGlzdC5hZGQoXCJidXJnZXItbGluay1hY3RpdmVcIilcclxuICAgICAgICBpZiAoaXRlbS5jbGFzc0xpc3QuY29udGFpbnMoXCJidXJnZXItbGluay1hY3RpdmVcIikpIHtcclxuICAgICAgICAgIGJ1cmdlck1lbnUuY2xhc3NMaXN0LnJlbW92ZShcImJ1cmdlci1tZW51LWFjdGl2ZVwiKTtcclxuICAgICAgICB9XHJcbiAgICAgIH0pO1xyXG4gICAgfSk7XHJcbiAgICBcclxuICAgIGNsb3NlQnVyZ2VyTWVudS5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKGUpID0+IHtcclxuICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xyXG4gICAgICBidXJnZXJNZW51LmNsYXNzTGlzdC5yZW1vdmUoXCJidXJnZXItbWVudS1hY3RpdmVcIik7XHJcbiAgICB9KTtcclxuICAgIH0pKClcclxuICAgIFxyXG4gICAgXHJcbiAgICBcclxuICAgIC8vICQoXCIuaGFtYnVyZ2VyXCIpLm9uKFwiY2xpY2tcIiwgZnVuY3Rpb24gKGV2ZW50KSB7XHJcbiAgICAvLyAgICQoJy5idXJnZXItbWVudScpLmFkZENsYXNzKFwiYnVyZ2VyLW1lbnUtYWN0aXZlXCIpO1xyXG4gICAgLy8gfSk7XHJcbiAgICBcclxuICAgIC8vICQoXCIuYnVyZ2VyLW1lbnVfX2Nsb3NlXCIpLm9uKFwiY2xpY2tcIiwgZnVuY3Rpb24gKGV2ZW50KSB7XHJcbiAgICAvLyAgICQoJy5idXJnZXItbWVudScpLnJlbW92ZUNsYXNzKFwiYnVyZ2VyLW1lbnUtYWN0aXZlXCIpO1xyXG4gICAgLy8gfSk7XHJcbiAgICBcclxuICAgIC8vICQoXCIuYnVyZ2VyLWl0ZW1cIikub24oXCJjbGlja1wiLCBmdW5jdGlvbiAoZXZlbnQpIHtcclxuICAgIC8vICAgJCgnLmJ1cmdlci1tZW51JykucmVtb3ZlQ2xhc3MoXCJidXJnZXItbWVudS1hY3RpdmVcIik7XHJcbiAgICAvLyB9KTsiLCIvL2pxdWVyeVxyXG5jb25zdCBtZXN1cmVXaWR0aCA9IGl0ZW0gPT4ge1xyXG4gICAgbGV0IHJlcUl0ZW1XaWR0aCA9IDA7XHJcbiAgXHJcbiAgICBjb25zdCBzY3JlZW5XaWR0aCA9ICQod2luZG93KS53aWR0aCgpO1xyXG4gICAgY29uc3QgY29udGFpbmVyID0gaXRlbS5jbG9zZXN0KFwiLm1lbnUtYWNjb19fbGlzdFwiKTtcclxuICAgIGNvbnN0IHRpdGxlc0Jsb2NrcyA9IGNvbnRhaW5lci5maW5kKFwiLm1lbnUtYWNjb19fYnV0dG9uXCIpO1xyXG4gICAgY29uc3QgdGl0bGVzV2lkdGggPSB0aXRsZXNCbG9ja3Mud2lkdGgoKSAqIHRpdGxlc0Jsb2Nrcy5sZW5ndGg7XHJcbiAgXHJcbiAgICBjb25zdCB0ZXh0Q29udGFpbmVyID0gaXRlbS5maW5kKFwiLm1lbnUtYWNjb19fZGVzY1wiKTtcclxuICAgIGNvbnN0IHBhZGRpbmdMZWZ0ID0gcGFyc2VJbnQodGV4dENvbnRhaW5lci5jc3MoXCJwYWRkaW5nLWxlZnRcIikpO1xyXG4gICAgY29uc3QgcGFkZGluZ1JpZ2h0ID0gcGFyc2VJbnQodGV4dENvbnRhaW5lci5jc3MoXCJwYWRkaW5nLXJpZ2h0XCIpKTtcclxuICBcclxuICAgIGNvbnN0IGlzTW9iaWxlID0gd2luZG93Lm1hdGNoTWVkaWEoXCIobWF4LXdpZHRoOiA3ODZweClcIikubWF0Y2hlcztcclxuICBcclxuICAgIGlmIChpc01vYmlsZSkge1xyXG4gICAgICByZXFJdGVtV2lkdGggPSBzY3JlZW5XaWR0aCAtIHRpdGxlc1dpZHRoO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgcmVxSXRlbVdpZHRoID0gNTAwO1xyXG4gICAgfVxyXG4gIFxyXG4gICAgcmV0dXJuIHtcclxuICAgICAgY29udGFpbmVyOiByZXFJdGVtV2lkdGgsXHJcbiAgICAgIHRleHRDb250YWluZXI6IHJlcUl0ZW1XaWR0aCAtIHBhZGRpbmdSaWdodCAtIHBhZGRpbmdMZWZ0XHJcbiAgICB9XHJcbiAgfTtcclxuICBcclxuICBjb25zdCBjbG9zZUV2ZXJ5SXRlbUluQ29udGFpbmVyID0gY29udGFpbmVyID0+IHtcclxuICAgIGNvbnN0IGl0ZW1zID0gY29udGFpbmVyLmZpbmQoXCIubWVudS1hY2NvX19pdGVtXCIpO1xyXG4gICAgY29uc3QgY29udGVudCA9IGNvbnRhaW5lci5maW5kKFwiLm1lbnUtYWNjb19fY29udGVudFwiKTtcclxuICBcclxuICAgIGl0ZW1zLnJlbW92ZUNsYXNzKFwiYWN0aXZlXCIpO1xyXG4gICAgY29udGVudC53aWR0aCgwKTtcclxuICB9XHJcbiAgXHJcbiAgY29uc3Qgb3Blbkl0ZW0gPSAoaXRlbSkgPT4ge1xyXG4gICAgY29uc3QgaGlkZGVuQ29udGVudCA9IGl0ZW0uZmluZChcIi5tZW51LWFjY29fX2NvbnRlbnRcIik7XHJcbiAgICBjb25zdCByZXFXaWR0aCA9IG1lc3VyZVdpZHRoKGl0ZW0pO1xyXG4gICAgY29uc3QgdGV4dEJsb2NrID0gaXRlbS5maW5kKFwiLm1lbnUtYWNjb19fZGVzY1wiKTtcclxuICBcclxuICAgIGl0ZW0uYWRkQ2xhc3MoXCJhY3RpdmVcIik7XHJcbiAgICBoaWRkZW5Db250ZW50LndpZHRoKHJlcVdpZHRoLmNvbnRhaW5lcik7XHJcbiAgICB0ZXh0QmxvY2sud2lkdGgocmVxV2lkdGgudGV4dENvbnRhaW5lcik7XHJcbiAgfVxyXG4gIFxyXG4gICQoXCIubWVudS1hY2NvX19idXR0b25cIikub24oXCJjbGlja1wiLCBlID0+IHtcclxuICAgIGUucHJldmVudERlZmF1bHQoKTtcclxuICBcclxuICAgIGNvbnN0ICR0aGlzID0gJChlLmN1cnJlbnRUYXJnZXQpO1xyXG4gICAgY29uc3QgaXRlbSA9ICR0aGlzLmNsb3Nlc3QoXCIubWVudS1hY2NvX19pdGVtXCIpO1xyXG4gICAgY29uc3QgaXRlbU9wZW5lZCA9IGl0ZW0uaGFzQ2xhc3MoXCJhY3RpdmVcIik7XHJcbiAgICBjb25zdCBjb250YWluZXIgPSAkdGhpcy5jbG9zZXN0KFwiLm1lbnUtYWNjb19fbGlzdFwiKTtcclxuICBcclxuICAgIGlmIChpdGVtT3BlbmVkKSB7XHJcbiAgICAgIGNsb3NlRXZlcnlJdGVtSW5Db250YWluZXIoY29udGFpbmVyKVxyXG4gICAgfSBlbHNlIHtcclxuICAgICAgY2xvc2VFdmVyeUl0ZW1JbkNvbnRhaW5lcihjb250YWluZXIpXHJcbiAgICAgIG9wZW5JdGVtKGl0ZW0pO1xyXG4gICAgfVxyXG4gIH0pO1xyXG4gIFxyXG4gIFxyXG4gIC8vanMgXHJcbiAgLy8gY29uc3QgbWVudSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjaG9yaXpvbnRhbE1lbnVcIik7XHJcbiAgLy8gY29uc3QgaXRlbXMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKFwiLm1lbnUtYWNjb19faXRlbVwiKTtcclxuICBcclxuICAvLyBjb25zdCBnZXRJdGVtV2lkdGggPSAoaXRlbSkgPT4ge1xyXG4gIC8vICAgbGV0IHJlc3VsdFdpZHRoID0gNTI0O1xyXG4gIC8vICAgY29uc3Qgd2luZG93V2lkdGggPSB3aW5kb3cuaW5uZXJXaWR0aDtcclxuICAvLyAgIGNvbnN0IGl0ZW1XaWR0aCA9IGl0ZW0ub2Zmc2V0V2lkdGg7XHJcbiAgXHJcbiAgLy8gICBjb25zdCBpc1RhYmxldCA9IHdpbmRvdy5tYXRjaE1lZGlhKFwiKG1heC13aWR0aDogNzY4cHgpXCIpLm1hdGNoZXM7XHJcbiAgLy8gICBjb25zdCBpc01vYmlsZSA9IHdpbmRvdy5tYXRjaE1lZGlhKFwiKG1heC13aWR0aDogNDgwcHgpXCIpLm1hdGNoZXM7XHJcbiAgXHJcbiAgLy8gICBpZiAoaXNUYWJsZXQpIHtcclxuICAvLyAgICAgcmVzdWx0V2lkdGggPSB3aW5kb3dXaWR0aCAtIGl0ZW1XaWR0aCAqIGl0ZW1zLmxlbmd0aDtcclxuICAvLyAgIH1cclxuICBcclxuICAvLyAgIGlmIChpc01vYmlsZSkge1xyXG4gIC8vICAgICByZXN1bHRXaWR0aCA9IHdpbmRvd1dpZHRoIC0gaXRlbVdpZHRoO1xyXG4gIC8vICAgfVxyXG4gIFxyXG4gIC8vICAgcmV0dXJuIHJlc3VsdFdpZHRoO1xyXG4gIC8vIH07XHJcbiAgXHJcbiAgLy8gY29uc3Qgc2V0SXRlbVdpZHRoID0gKGl0ZW0sIHdpZHRoKSA9PiB7XHJcbiAgLy8gICBjb25zdCBpdGVtQ29udGVudCA9IGl0ZW0ubmV4dEVsZW1lbnRTaWJsaW5nO1xyXG4gIC8vICAgY29uc3QgaXRlbVRleHQgPSBpdGVtQ29udGVudC5maXJzdEVsZW1lbnRDaGlsZDtcclxuICAvLyAgIGl0ZW1Db250ZW50LnN0eWxlLndpZHRoID0gYCR7d2lkdGh9cHhgO1xyXG4gIC8vICAgaXRlbVRleHQuc3R5bGUud2lkdGggPSBgJHt3aWR0aH1weGA7XHJcbiAgLy8gfTtcclxuICBcclxuICAvLyBjb25zdCBjbG9zZUl0ZW0gPSAoaXRlbSkgPT4ge1xyXG4gIC8vICAgY29uc3QgaXRlbVBhcmVudCA9IGl0ZW0ucGFyZW50RWxlbWVudDtcclxuICAvLyAgIGl0ZW1QYXJlbnQuY2xhc3NMaXN0LnJlbW92ZShcIm1lbnUtYWNjb19faXRlbS0tYWN0aXZlXCIpO1xyXG4gIC8vICAgaXRlbS5jbGFzc0xpc3QucmVtb3ZlKFwibWVudS1hY2NvX19idXR0b24tLWFjdGl2ZVwiKTtcclxuICAvLyAgIHNldEl0ZW1XaWR0aChpdGVtLCAwKTtcclxuICAvLyB9O1xyXG4gIFxyXG4gIC8vIGNvbnN0IG9wZW5JdGVtID0gKGl0ZW0pID0+IHtcclxuICAvLyAgIGNvbnN0IGl0ZW1QYXJlbnQgPSBpdGVtLnBhcmVudEVsZW1lbnQ7XHJcbiAgLy8gICBpdGVtUGFyZW50LmNsYXNzTGlzdC5hZGQoXCJtZW51LWFjY29fX2l0ZW0tLWFjdGl2ZVwiKTtcclxuICAvLyAgIGl0ZW0uY2xhc3NMaXN0LmFkZChcIm1lbnUtYWNjb19fYnV0dG9uLS1hY3RpdmVcIik7XHJcbiAgLy8gICBjb25zdCB3aWR0aCA9IGdldEl0ZW1XaWR0aChpdGVtKTtcclxuICAvLyAgIHNldEl0ZW1XaWR0aChpdGVtLCB3aWR0aCk7XHJcbiAgLy8gfTtcclxuICBcclxuICAvLyBtZW51LmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoZSkgPT4ge1xyXG4gIC8vICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xyXG4gIC8vICAgY29uc3QgdGFyZ2V0ID0gZS50YXJnZXQ7XHJcbiAgLy8gICBjb25zdCBpc0FjdGl2ZSA9IHRhcmdldC5jbGFzc0xpc3QuY29udGFpbnMoXCJtZW51LWFjY29fX2J1dHRvbi0tYWN0aXZlXCIpO1xyXG4gIC8vICAgY29uc3QgYWN0aXZlRWxlbWVudCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIubWVudS1hY2NvX19idXR0b24tLWFjdGl2ZVwiKTtcclxuICBcclxuICAvLyAgIGlmICh0YXJnZXQuY2xhc3NMaXN0LmNvbnRhaW5zKFwibWVudS1hY2NvX19idXR0b25cIikgJiYgaXNBY3RpdmUpIHtcclxuICAvLyAgICAgaWYgKGFjdGl2ZUVsZW1lbnQpIHtcclxuICAvLyAgICAgICBjbG9zZUl0ZW0oYWN0aXZlRWxlbWVudCk7XHJcbiAgLy8gICAgIH1cclxuICAvLyAgIH1cclxuICAvLyAgIGlmICh0YXJnZXQuY2xhc3NMaXN0LmNvbnRhaW5zKFwibWVudS1hY2NvX19idXR0b25cIikgJiYgIWlzQWN0aXZlKSB7XHJcbiAgLy8gICAgIGlmIChhY3RpdmVFbGVtZW50KSB7XHJcbiAgLy8gICAgICAgY2xvc2VJdGVtKGFjdGl2ZUVsZW1lbnQpO1xyXG4gIC8vICAgICB9XHJcbiAgLy8gICAgIG9wZW5JdGVtKHRhcmdldCk7XHJcbiAgLy8gICB9XHJcbiAgLy8gfSk7XHJcbiAgXHJcbiAgLy8gd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoXCJyZXNpemVcIiwgKCkgPT4ge1xyXG4gIC8vICAgY29uc3QgYWN0aXZlQnV0dG9uID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5tZW51LWFjY29fX2J1dHRvbi0tYWN0aXZlXCIpO1xyXG4gIC8vICAgaWYgKGFjdGl2ZUJ1dHRvbikge1xyXG4gIC8vICAgICBjbG9zZUl0ZW0oYWN0aXZlQnV0dG9uKTtcclxuICAvLyAgIH1cclxuICAvLyB9KTsiLCIiLCJsZXQgbXlNYXA7XHJcbmNvbnN0IGluaXQgPSAoKSA9PiB7XHJcbiBteU1hcCA9IG5ldyB5bWFwcy5NYXAoXCJtYXBcIiwge1xyXG4gIGNlbnRlcjogWzU1Ljc1MjAwNCwgMzcuNTc2MTMzXSxcclxuICAgem9vbTogMTYsXHJcbiAgIGNvbnRyb2xzOiBbXSxcclxuIH0pO1xyXG4gXHJcbiBsZXQgY29vcmRzID0gW1xyXG4gICAgIFs1NS43NTIwMDQsIDM3LjU3NjEzM10sXHJcbiAgIF0sXHJcbiAgIG15Q29sbGVjdGlvbiA9IG5ldyB5bWFwcy5HZW9PYmplY3RDb2xsZWN0aW9uKHt9LCB7XHJcbiAgICAgZHJhZ2dhYmxlOiBmYWxzZSxcclxuICAgICBpY29uTGF5b3V0OiAnZGVmYXVsdCNpbWFnZScsXHJcbiAgICAgaWNvbkltYWdlSHJlZjogJy4vaW1nL2ljb25zL2dlby5zdmcnLFxyXG4gICAgIGljb25JbWFnZVNpemU6IFs1OCwgNzNdLFxyXG4gICAgIGljb25JbWFnZU9mZnNldDogWy0zNSwgLTUyXVxyXG4gICB9KTtcclxuIFxyXG4gZm9yIChsZXQgaSA9IDA7IGkgPCBjb29yZHMubGVuZ3RoOyBpKyspIHtcclxuICAgbXlDb2xsZWN0aW9uLmFkZChuZXcgeW1hcHMuUGxhY2VtYXJrKGNvb3Jkc1tpXSkpO1xyXG4gfVxyXG4gXHJcbiBteU1hcC5nZW9PYmplY3RzLmFkZChteUNvbGxlY3Rpb24pO1xyXG4gXHJcbiBteU1hcC5iZWhhdmlvcnMuZGlzYWJsZSgnc2Nyb2xsWm9vbScpO1xyXG59O1xyXG4gXHJcbnltYXBzLnJlYWR5KGluaXQpOyIsImNvbnN0IHZhbGlkYXRlRmllbGRzID0gKGZvcm0sIGZpZWxkc0FycmF5KSA9PiB7XHJcbiBcclxuICAgIGZpZWxkc0FycmF5LmZvckVhY2goKGZpZWxkKSA9PiB7XHJcbiAgICAgIGZpZWxkLnJlbW92ZUNsYXNzKFwiaW5wdXQtZXJyb3JcIik7XHJcbiAgICAgIGlmIChmaWVsZC52YWwoKS50cmltKCkgPT09IFwiXCIpIHtcclxuICAgICAgICBmaWVsZC5hZGRDbGFzcyhcImlucHV0LWVycm9yXCIpO1xyXG4gICAgICB9XHJcbiAgICB9KTtcclxuICBcclxuICAgIGNvbnN0IGVycm9yRmllbGRzID0gZm9ybS5maW5kKFwiLmlucHV0LWVycm9yXCIpO1xyXG4gIFxyXG4gICAgcmV0dXJuIGVycm9yRmllbGRzLmxlbmd0aCA9PT0gMDsgIFxyXG4gIH1cclxuICBcclxuICAkKFwiLmZvcm1cIikuc3VibWl0KGUgPT4ge1xyXG4gICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xyXG4gIFxyXG4gICAgY29uc3QgZm9ybSA9ICQoZS5jdXJyZW50VGFyZ2V0KTtcclxuICAgIGNvbnN0IG5hbWUgPSBmb3JtLmZpbmQoXCJbbmFtZT0nbmFtZSddXCIpO1xyXG4gICAgY29uc3QgcGhvbmUgPSBmb3JtLmZpbmQoXCJbbmFtZT0ncGhvbmUnXVwiKTtcclxuICAgIGNvbnN0IGNvbW1lbnQgPSBmb3JtLmZpbmQoXCJbbmFtZT0nY29tbWVudCddXCIpO1xyXG4gICAgY29uc3QgdG8gPSBmb3JtLmZpbmQoXCJbbmFtZT0ndG8nXVwiKTtcclxuICBcclxuICAgIGNvbnN0IG1vZGFsID0gJChcIiNtb2RhbFwiKTtcclxuICAgIGNvbnN0IGNvbnRlbnQgPSBtb2RhbC5maW5kKFwiLm1vZGFsX19jb250ZW50XCIpO1xyXG4gIFxyXG4gICAgbW9kYWwucmVtb3ZlQ2xhc3MoXCJlcnJvci1tb2RhbFwiKTtcclxuICBcclxuICAgIGNvbnN0IGlzVmFsaWQgPSB2YWxpZGF0ZUZpZWxkcyhmb3JtLCBbbmFtZSwgcGhvbmUsIGNvbW1lbnQsIHRvXSk7XHJcbiAgXHJcbiAgICBpZiAoaXNWYWxpZCkge1xyXG4gICAgICBjb25zdCByZXF1ZXN0ID0gJC5hamF4KHtcclxuICAgICAgICB1cmw6IFwiaHR0cHM6Ly93ZWJkZXYtYXBpLmxvZnRzY2hvb2wuY29tL3NlbmRtYWlsXCIsXHJcbiAgICAgICAgbWV0aG9kOiBcInBvc3RcIixcclxuICAgICAgICBkYXRhOiB7XHJcbiAgICAgICAgICBuYW1lOiBuYW1lLnZhbCgpLFxyXG4gICAgICAgICAgcGhvbmU6IHBob25lLnZhbCgpLFxyXG4gICAgICAgICAgY29tbWVudDogY29tbWVudC52YWwoKSxcclxuICAgICAgICAgIHRvOiB0by52YWwoKSxcclxuICAgICAgICB9LFxyXG4gICAgICB9KTtcclxuICBcclxuICAgICAgcmVxdWVzdC5kb25lKGRhdGEgPT4ge1xyXG4gICAgICAgIGNvbnRlbnQudGV4dChkYXRhLm1lc3NhZ2UpXHJcbiAgICAgICAgbW9kYWwuYWRkQ2xhc3MoXCJzdWNjZXNzLW1vZGFsXCIpO1xyXG4gICAgICB9KTtcclxuICBcclxuICAgICAgcmVxdWVzdC5mYWlsKGRhdGEgPT4ge1xyXG4gICAgICAgIGNvbnN0IG1lc3NhZ2UgPSBkYXRhLnJlc3BvbnNlSlNPTi5tZXNzYWdlO1xyXG4gICAgICAgIGNvbnRlbnQudGV4dChtZXNzYWdlKTtcclxuICAgICAgICBtb2RhbC5hZGRDbGFzcyhcImVycm9yLW1vZGFsXCIpO1xyXG4gICAgICB9KTtcclxuICBcclxuICAgICAgcmVxdWVzdC5hbHdheXMoKCkgPT4ge1xyXG4gICAgICAgICQuZmFuY3lib3gub3Blbih7XHJcbiAgICAgICAgICBzcmM6IFwiI21vZGFsXCIsXHJcbiAgICAgICAgICB0eXBlOiBcImlubGluZVwiLFxyXG4gICAgICAgICAgc21hbGxCdG46IGZhbHNlXHJcbiAgICAgICAgfSk7XHJcbiAgICAgIH0pO1xyXG4gICAgfVxyXG4gIH0pO1xyXG4gIFxyXG4gICQoXCIuYXBwLXN1Ym1pdC1idG5cIikuY2xpY2soZSA9PiB7XHJcbiAgICBlLnByZXZlbnREZWZhdWx0KCk7XHJcbiAgXHJcbiAgICAkLmZhbmN5Ym94LmNsb3NlKCk7XHJcbiAgfSkiLCI7KGZ1bmN0aW9uKCkge1xyXG4gICAgY29uc3Qgc2VjdGlvbnMgPSAkKFwic2VjdGlvblwiKTtcclxuICAgIGNvbnN0IGRpc3BsYXkgPSAkKFwiLm1haW5jb250ZW50XCIpO1xyXG4gICAgY29uc3Qgc2lkZU1lbnUgPSAkKFwiLmZpeGVkLW1lbnVcIik7XHJcbiAgICBjb25zdCBtZW51SXRlbXMgPSBzaWRlTWVudS5maW5kKFwiLmZpeGVkLW1lbnVfX2l0ZW1cIik7XHJcbiAgICBcclxuICAgIGNvbnN0IG1vYmlsZURldGVjdCA9IG5ldyBNb2JpbGVEZXRlY3Qod2luZG93Lm5hdmlnYXRvci51c2VyQWdlbnQpO1xyXG4gICAgY29uc3QgaXNNb2JpbGUgPSBtb2JpbGVEZXRlY3QubW9iaWxlKCk7XHJcbiAgICBcclxuICAgIFxyXG4gICAgbGV0IGluU2Nyb2xsID0gZmFsc2U7XHJcbiAgICBcclxuICAgIHNlY3Rpb25zLmZpcnN0KCkuYWRkQ2xhc3MoXCJhY3RpdmVcIik7XHJcbiAgICBcclxuICAgIGNvbnN0IGNvdW50U2VjdGlvblBvc2l0aW9uID0gc2VjdGlvbkVxID0+IHtcclxuICAgICAgY29uc3QgcG9zaXRpb24gPSBzZWN0aW9uRXEgKiAtMTAwO1xyXG4gICAgXHJcbiAgICAgIGlmIChpc05hTihwb3NpdGlvbikpIHtcclxuICAgICAgICBjb25zb2xlLmVycm9yKFwi0L/QtdGA0LXQtNCw0L3QviDQvdC10LLQtdGA0L3QvtC1INC30L3QsNGH0LXQvdC40LUg0LIgY291bnRTZWN0aW9uUG9zaXRpb25cIik7XHJcbiAgICAgICAgcmV0dXJuIDA7XHJcbiAgICAgIH1cclxuICAgIFxyXG4gICAgICByZXR1cm4gcG9zaXRpb247XHJcbiAgICB9XHJcbiAgICBcclxuICAgIGNvbnN0IGNoYW5nZU1lbnVUaGVtZUZvclNlY3Rpb24gPSBzZWN0aW9uRXEgPT4ge1xyXG4gICAgICBjb25zdCBjdXJyZW50U2VjdGlvbiA9IHNlY3Rpb25zLmVxKHNlY3Rpb25FcSk7XHJcbiAgICAgIGNvbnN0IG1lbnVUaGVtZSA9IGN1cnJlbnRTZWN0aW9uLmF0dHIoXCJkYXRhLXNpZGVtZW51LXRoZW1lXCIpO1xyXG4gICAgICBjb25zdCBzaWRlTWVudUxpbmsgPSAkKFwiLmZpeGVkLW1lbnVfX2xpbmtcIik7XHJcbiAgICAgIGNvbnN0IGFjdGl2ZUNsYXNzID0gKFwiZml4ZWQtbWVudS0tc2hhZG93ZWRcIik7XHJcbiAgICBcclxuICAgIFxyXG4gICAgICBpZiAobWVudVRoZW1lID09PSBcImJsYWNrXCIpIHtcclxuICAgICAgICBzaWRlTWVudS5hZGRDbGFzcyhhY3RpdmVDbGFzcyksXHJcbiAgICAgICAgICBzaWRlTWVudUxpbmsuYWRkQ2xhc3MoXCJmaXhlZC1tZW51X19saW5rLS1zaGFkb3dlZFwiKTtcclxuICAgICAgfSBlbHNlIHtcclxuICAgICAgICBzaWRlTWVudS5yZW1vdmVDbGFzcyhcImZpeGVkLW1lbnUtLXNoYWRvd2VkXCIpLFxyXG4gICAgICAgICAgc2lkZU1lbnVMaW5rLnJlbW92ZUNsYXNzKFwiZml4ZWQtbWVudV9fbGluay0tc2hhZG93ZWRcIik7XHJcbiAgICAgIH1cclxuICAgIH1cclxuICAgIFxyXG4gICAgY29uc3QgcmVzZXRBY3RpdmVDbGFzc0Zvckl0ZW0gPSAoaXRlbXMsIGl0ZW1FcSwgYWN0aXZlQ2xhc3MpID0+IHtcclxuICAgICAgaXRlbXMuZXEoaXRlbUVxKS5hZGRDbGFzcyhhY3RpdmVDbGFzcykuc2libGluZ3MoKS5yZW1vdmVDbGFzcyhhY3RpdmVDbGFzcyk7XHJcbiAgICB9XHJcbiAgICBcclxuICAgIGNvbnN0IHBlcmZvcm1UcmFuc2l0aW9uID0gKHNlY3Rpb25FcSkgPT4ge1xyXG4gICAgICBpZiAoaW5TY3JvbGwpIHJldHVybjtcclxuICAgIFxyXG4gICAgICBjb25zdCB0cmFuc2l0aW9uT3ZlciA9IDEwMDA7XHJcbiAgICAgIGNvbnN0IG1vdXNlSW5lcnRpYU92ZXIgPSAwO1xyXG4gICAgXHJcbiAgICAgIGluU2Nyb2xsID0gdHJ1ZTtcclxuICAgIFxyXG4gICAgICBjb25zdCBwb3NpdGlvbiA9IGNvdW50U2VjdGlvblBvc2l0aW9uKHNlY3Rpb25FcSk7XHJcbiAgICBcclxuICAgICAgY2hhbmdlTWVudVRoZW1lRm9yU2VjdGlvbihzZWN0aW9uRXEpO1xyXG4gICAgXHJcbiAgICAgIGRpc3BsYXkuY3NzKHtcclxuICAgICAgICB0cmFuc2Zvcm06IGB0cmFuc2xhdGVZKCR7cG9zaXRpb259JSlgLFxyXG4gICAgICB9KTtcclxuICAgIFxyXG4gICAgICByZXNldEFjdGl2ZUNsYXNzRm9ySXRlbShzZWN0aW9ucywgc2VjdGlvbkVxLCBcImFjdGl2ZVwiKTtcclxuICAgIFxyXG4gICAgICBzZXRUaW1lb3V0KCgpID0+IHtcclxuICAgICAgICBpblNjcm9sbCA9IGZhbHNlO1xyXG4gICAgXHJcbiAgICAgICAgcmVzZXRBY3RpdmVDbGFzc0Zvckl0ZW0obWVudUl0ZW1zLCBzZWN0aW9uRXEsIFwiZml4ZWQtbWVudV9faXRlbS0tYWN0aXZlXCIpO1xyXG4gICAgICB9LCB0cmFuc2l0aW9uT3ZlciArIG1vdXNlSW5lcnRpYU92ZXIpO1xyXG4gICAgXHJcbiAgICB9O1xyXG4gICAgXHJcbiAgICBjb25zdCB2aWV3cG9ydFNjcm9sbGVyID0gKCkgPT4ge1xyXG4gICAgICBjb25zdCBhY3RpdmVTZWN0aW9uID0gc2VjdGlvbnMuZmlsdGVyKFwiLmFjdGl2ZVwiKTtcclxuICAgICAgY29uc3QgbmV4dFNlY3Rpb24gPSBhY3RpdmVTZWN0aW9uLm5leHQoKTtcclxuICAgICAgY29uc3QgcHJldlNlY3Rpb24gPSBhY3RpdmVTZWN0aW9uLnByZXYoKTtcclxuICAgIFxyXG4gICAgICByZXR1cm4ge1xyXG4gICAgICAgIG5leHQoKSB7XHJcbiAgICAgICAgICBpZiAobmV4dFNlY3Rpb24ubGVuZ3RoKSB7XHJcbiAgICAgICAgICAgIHBlcmZvcm1UcmFuc2l0aW9uKG5leHRTZWN0aW9uLmluZGV4KCkpO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH0sXHJcbiAgICAgICAgcHJldigpIHtcclxuICAgICAgICAgIGlmIChwcmV2U2VjdGlvbi5sZW5ndGgpIHtcclxuICAgICAgICAgICAgcGVyZm9ybVRyYW5zaXRpb24ocHJldlNlY3Rpb24uaW5kZXgoKSk7XHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfSxcclxuICAgICAgfTtcclxuICAgIH07XHJcbiAgICBcclxuICAgICQod2luZG93KS5vbihcIndoZWVsXCIsIChlKSA9PiB7XHJcbiAgICAgIGNvbnN0IGRlbHRhWSA9IGUub3JpZ2luYWxFdmVudC5kZWx0YVk7XHJcbiAgICAgIGNvbnN0IHNjcm9sbGVyID0gdmlld3BvcnRTY3JvbGxlcigpO1xyXG4gICAgXHJcbiAgICAgIGlmIChkZWx0YVkgPiAwKSB7XHJcbiAgICAgICAgc2Nyb2xsZXIubmV4dCgpO1xyXG4gICAgICB9XHJcbiAgICBcclxuICAgICAgaWYgKGRlbHRhWSA8IDApIHtcclxuICAgICAgICBzY3JvbGxlci5wcmV2KCk7XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG4gICAgXHJcbiAgICAkKHdpbmRvdykub24oXCJrZXlkb3duXCIsIChlKSA9PiB7XHJcbiAgICAgIGNvbnN0IHRhZ05hbWUgPSBlLnRhcmdldC50YWdOYW1lLnRvTG93ZXJDYXNlKCk7XHJcbiAgICAgIGNvbnN0IHVzZXJUeXBpbmdJbklucHV0cyA9IHRhZ05hbWUgPT09IFwiaW5wdXRcIiB8fCB0YWdOYW1lID09PSBcInRleHRhcmVhXCI7XHJcbiAgICAgIGNvbnN0IHNjcm9sbGVyID0gdmlld3BvcnRTY3JvbGxlcigpO1xyXG4gICAgXHJcbiAgICAgIGlmICh1c2VyVHlwaW5nSW5JbnB1dHMpIHJldHVybjtcclxuICAgIFxyXG4gICAgICBzd2l0Y2ggKGUua2V5Q29kZSkge1xyXG4gICAgICAgIGNhc2UgMzg6XHJcbiAgICAgICAgICBzY3JvbGxlci5wcmV2KCk7XHJcbiAgICAgICAgICBicmVhaztcclxuICAgIFxyXG4gICAgICAgIGNhc2UgNDA6XHJcbiAgICAgICAgICBzY3JvbGxlci5uZXh0KCk7XHJcbiAgICAgICAgICBicmVhaztcclxuICAgICAgfVxyXG4gICAgfSk7XHJcbiAgICBcclxuICAgICQoXCIud3JhcHBlclwiKS5vbihcInRvdWNobW92ZVwiLCBlID0+IGUucHJldmVudERlZmF1bHQoKSk7XHJcbiAgICBcclxuICAgICQoXCJbZGF0YS1zY3JvbGwtdG9dXCIpLmNsaWNrKChlKSA9PiB7XHJcbiAgICAgIGUucHJldmVudERlZmF1bHQoKTtcclxuICAgIFxyXG4gICAgICBjb25zdCAkdGhpcyA9ICQoZS5jdXJyZW50VGFyZ2V0KTtcclxuICAgICAgY29uc3QgdGFyZ2V0ID0gJHRoaXMuYXR0cihcImRhdGEtc2Nyb2xsLXRvXCIpO1xyXG4gICAgICBjb25zdCByZXFTZWN0aW9uID0gJChgW2RhdGEtc2VjdGlvbi1pZD0ke3RhcmdldH1dYCk7XHJcbiAgICBcclxuICAgICAgcGVyZm9ybVRyYW5zaXRpb24ocmVxU2VjdGlvbi5pbmRleCgpKTtcclxuICAgIH0pO1xyXG4gICAgXHJcbiAgICBpZiAoaXNNb2JpbGUpIHtcclxuICAgIC8vaHR0cHM6Ly9naXRodWIuY29tL21hdHRicnlzb24vVG91Y2hTd2lwZS1KcXVlcnktUGx1Z2luXHJcbiAgICBcclxuICAgICQoXCJib2R5XCIpLnN3aXBlKHtcclxuICAgICAgc3dpcGU6IGZ1bmN0aW9uIChldmVudCwgZGlyZWN0aW9uKSB7XHJcbiAgICAgICAgY29uc3Qgc2Nyb2xsZXIgPSB2aWV3cG9ydFNjcm9sbGVyKCk7XHJcbiAgICAgICAgbGV0IHNjcm9sbERpcmVjdGlvbiA9IFwiXCI7XHJcbiAgICAgICAgXHJcbiAgICAgICAgaWYgKGRpcmVjdGlvbiA9PT0gXCJ1cFwiKSBzY3JvbGxEaXJlY3Rpb24gPSBcIm5leHRcIjtcclxuICAgICAgICBpZiAoZGlyZWN0aW9uID09PSBcImRvd25cIikgc2Nyb2xsRGlyZWN0aW9uID0gXCJwcmV2XCI7XHJcbiAgICBcclxuICAgICAgICBpZiAoc2Nyb2xsRGlyZWN0aW9uKSB7XHJcbiAgICAgICAgICBzY3JvbGxlcltzY3JvbGxEaXJlY3Rpb25dKCk7XHJcbiAgICAgICAgfVxyXG4gICAgICB9LFxyXG4gICAgfSk7XHJcbiAgICB9XHJcbiAgICB9KSgpIiwiOyhmdW5jdGlvbigpIHtcclxuICAgIGNvbnN0IGZpbmRCbG9ja0J5QWxpYXMgPSAoYWxpYXMpID0+IHtcclxuICAgICAgcmV0dXJuICQoXCIucmV2aWV3X19pdGVtXCIpLmZpbHRlcigobmR4LCBpdGVtKSA9PiB7XHJcbiAgICAgICAgcmV0dXJuICQoaXRlbSkuYXR0cihcImRhdGEtbGlua2VkLXdpdGhcIikgPT09IGFsaWFzO1xyXG4gICAgICB9KTtcclxuICAgIH07XHJcbiAgICBcclxuICAgICQoXCIuaW50ZXJhY3RpdmUtYXZhdGFyX19saW5rXCIpLmNsaWNrKChlKSA9PiB7XHJcbiAgICAgIGUucHJldmVudERlZmF1bHQoKTtcclxuICAgIFxyXG4gICAgICBjb25zdCAkdGhpcyA9ICQoZS5jdXJyZW50VGFyZ2V0KTtcclxuICAgICAgY29uc3QgdGFyZ2V0ID0gJHRoaXMuYXR0cihcImRhdGEtb3BlblwiKTtcclxuICAgICAgY29uc3QgaXRlbVRvU2hvdyA9IGZpbmRCbG9ja0J5QWxpYXModGFyZ2V0KTtcclxuICAgICAgY29uc3QgY3VySXRlbSA9ICR0aGlzLmNsb3Nlc3QoXCIucmV2aWV3X19zd2l0Y2hlci1pdGVtXCIsXCIuaW50ZXJhY3RpdmUtYXZhdGFyXCIpO1xyXG4gICAgXHJcbiAgICAgIGl0ZW1Ub1Nob3cuYWRkQ2xhc3MoXCJyZXZpZXdfX2l0ZW0tLWFjdGl2ZVwiKS5zaWJsaW5ncygpLnJlbW92ZUNsYXNzKFwicmV2aWV3X19pdGVtLS1hY3RpdmVcIik7XHJcbiAgICAgIGN1ckl0ZW0uYWRkQ2xhc3MoXCJpbnRlcmFjdGl2ZS1hdmF0YXItLWFjdGl2ZVwiKS5zaWJsaW5ncygpLnJlbW92ZUNsYXNzKFwiaW50ZXJhY3RpdmUtYXZhdGFyLS1hY3RpdmVcIik7XHJcbiAgICB9KTtcclxuICAgIH0pKCkiLCI7KGZ1bmN0aW9uKCkge1xyXG4gICAgY29uc3Qgc2xpZGVyID0gJCgnLnByb2R1Y3RzX19saXN0JykuYnhTbGlkZXIoe1xyXG4gICAgICBwYWdlcjogZmFsc2UsXHJcbiAgICAgIGNvbnRyb2xzOiBmYWxzZSxcclxuICAgIH0pO1xyXG4gICAgXHJcbiAgICAkKFwiLnByb2R1Y3RzX19hcnJvdy0tcHJldlwiKS5jbGljaygoZSkgPT4ge1xyXG4gICAgICBlLnByZXZlbnREZWZhdWx0KCk7XHJcbiAgICAgIHNsaWRlci5nb1RvUHJldlNsaWRlKCk7XHJcbiAgICB9KTtcclxuICAgIFxyXG4gICAgJChcIi5wcm9kdWN0c19fYXJyb3ctLW5leHRcIikuY2xpY2soKGUpID0+IHtcclxuICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xyXG4gICAgICBzbGlkZXIuZ29Ub05leHRTbGlkZSgpO1xyXG4gICAgfSk7XHJcbiAgICB9KSgpIiwiOyhmdW5jdGlvbigpIHtcclxuICAgIGNvbnN0IG9wZW5JdGVtID0gaXRlbSA9PiB7XHJcbiAgICAgIGNvbnN0IGNvbnRhaW5lciA9IGl0ZW0uY2xvc2VzdChcIi50ZWFtX19pdGVtXCIpO1xyXG4gICAgICBjb25zdCBjb250ZW50QmxvY2sgPSBjb250YWluZXIuZmluZChcIi50ZWFtX19jb250ZW50XCIpO1xyXG4gICAgICBjb25zdCB0ZXh0QmxvY2sgPSBjb250ZW50QmxvY2suZmluZChcIi50ZWFtX19jb250ZW50LWJsb2NrXCIpOyBcclxuICAgICAgY29uc3QgcmVxSGVpZ2h0ID0gdGV4dEJsb2NrLmhlaWdodCgpO1xyXG4gICAgICBjb25zdCBzdmdJY29uID0gY29udGFpbmVyLmZpbmQoXCIudGVhbV9faWNvbi1pbWdcIik7XHJcbiAgICAgIGNvbnN0IGNvbG9yVGV4dCA9IGNvbnRhaW5lci5maW5kKFwiLnRlYW1fX25hbWVcIik7XHJcbiAgICBcclxuICAgICAgY29udGFpbmVyLmFkZENsYXNzKFwiYWN0aXZlXCIpO1xyXG4gICAgICBzdmdJY29uLmFkZENsYXNzKFwidGVhbV9faWNvbi1pbWctLWFjdGl2ZVwiKTtcclxuICAgICAgY29sb3JUZXh0LmFkZENsYXNzKFwidGVhbV9fbmFtZS0tY29sb3JcIik7XHJcbiAgICAgIGNvbnRlbnRCbG9jay5oZWlnaHQocmVxSGVpZ2h0KTtcclxuICAgIH1cclxuICAgIFxyXG4gICAgY29uc3QgY2xvc2VFdmVyeUl0ZW0gPSBjb250YWluZXIgPT4ge1xyXG4gICAgICBjb25zdCBpdGVtcyA9IGNvbnRhaW5lci5maW5kKFwiLnRlYW1fX2NvbnRlbnRcIik7XHJcbiAgICAgIGNvbnN0IGl0ZW1Db250YWluZXIgPSBjb250YWluZXIuZmluZChcIi50ZWFtX19pdGVtXCIpO1xyXG4gICAgICBjb25zdCBpdGVtU3ZnSWNvbiA9IGNvbnRhaW5lci5maW5kKFwiLnRlYW1fX2ljb24taW1nXCIpO1xyXG4gICAgICBjb25zdCBpdGVtQ29sb3JUZXh0ID0gY29udGFpbmVyLmZpbmQoXCIudGVhbV9fbmFtZVwiKTtcclxuICAgIFxyXG4gICAgICBpdGVtQ29udGFpbmVyLnJlbW92ZUNsYXNzKFwiYWN0aXZlXCIpO1xyXG4gICAgICBpdGVtU3ZnSWNvbi5yZW1vdmVDbGFzcyhcInRlYW1fX2ljb24taW1nLS1hY3RpdmVcIik7XHJcbiAgICAgIGl0ZW1Db2xvclRleHQucmVtb3ZlQ2xhc3MoXCJ0ZWFtX19uYW1lLS1jb2xvclwiKTtcclxuICAgICAgaXRlbXMuaGVpZ2h0KDApO1xyXG4gICAgfVxyXG4gICAgXHJcbiAgICAkKFwiLnRlYW1fX2J1dHRvblwiKS5jbGljayhlID0+IHtcclxuICAgICAgY29uc3QgJHRoaXMgPSAkKGUuY3VycmVudFRhcmdldCk7XHJcbiAgICAgIGNvbnN0IGNvbnRhaW5lciA9ICR0aGlzLmNsb3Nlc3QoXCIudGVhbV9fbGlzdFwiKTtcclxuICAgICAgY29uc3QgZWxlbUNvbnRhaW5lciA9ICR0aGlzLmNsb3Nlc3QoXCIudGVhbV9faXRlbVwiKTtcclxuICAgIFxyXG4gICAgICBpZiAoZWxlbUNvbnRhaW5lci5oYXNDbGFzcyhcImFjdGl2ZVwiKSkge1xyXG4gICAgICAgIGNsb3NlRXZlcnlJdGVtKGNvbnRhaW5lcik7XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgY2xvc2VFdmVyeUl0ZW0oY29udGFpbmVyKTtcclxuICAgICAgICBvcGVuSXRlbSgkdGhpcyk7XHJcbiAgICAgIH1cclxuICAgIH0pO1xyXG4gICAgfSkoKSIsImxldCBwbGF5ZXI7XHJcblxyXG5jb25zdCBmb3JtYXRUaW1lID0gdGltZVNlYyA9PiB7XHJcbiAgY29uc3Qgcm91bmRUaW1lID0gTWF0aC5yb3VuZCh0aW1lU2VjKTtcclxuXHJcbiAgY29uc3QgbWludXRlcyA9IE1hdGguZmxvb3Iocm91bmRUaW1lIC8gNjApO1xyXG4gIGNvbnN0IHNlY29uZHMgPSByb3VuZFRpbWUgLSBtaW51dGVzICogNjA7XHJcblxyXG4gIGNvbnN0IGZvcm1hdHRlZFNlY29uZHMgPSBzZWNvbmRzIDwgMTAgPyBgMCR7c2Vjb25kc31gIDogc2Vjb25kcztcclxuXHJcbiAgcmV0dXJuIGAke21pbnV0ZXN9OiR7Zm9ybWF0dGVkU2Vjb25kc31gO1xyXG59O1xyXG5cclxuY29uc3Qgb25QbGF5ZXJSZWFkeSA9ICgpID0+IHtcclxuICBsZXQgaW50ZXJ2YWw7XHJcbiAgbGV0IGR1cmF0aW9uU2VjID0gcGxheWVyLmdldER1cmF0aW9uKCk7XHJcblxyXG4gICQoXCIucGxheWVyX19kdXJhdGlvbi1lc3RpbWF0ZVwiKS50ZXh0KGZvcm1hdFRpbWUoZHVyYXRpb25TZWMpKTtcclxuXHJcbiAgaWYgKHR5cGVvZiBpbnRlcnZhbCAhPT0gXCJ1bmRlZmluZWRcIikge1xyXG4gICAgY2xlYXJJbnRlcnZhbChpbnRlcnZhbCk7XHJcbiAgfVxyXG5cclxuICBpbnRlcnZhbCA9IHNldEludGVydmFsKCgpID0+IHtcclxuICAgIGNvbnN0IGNvbXBsZXRlZFNlYyA9IHBsYXllci5nZXRDdXJyZW50VGltZSgpO1xyXG4gICAgY29uc3QgY29tcGxldGVkUGVyY2VudCA9IChjb21wbGV0ZWRTZWMgLyBkdXJhdGlvblNlYykgKiAxMDA7XHJcblxyXG4gICAgJChcIi5wbGF5ZXJfX3BsYXliYWNrLWJ1dHRvblwiKS5jc3Moe1xyXG4gICAgICBsZWZ0OiBgJHtjb21wbGV0ZWRQZXJjZW50fSVgXHJcbiAgICB9KTtcclxuXHJcbiAgICAkKFwiLnBsYXllcl9fZHVyYXRpb24tY29tcGxldGVkXCIpLnRleHQoZm9ybWF0VGltZShjb21wbGV0ZWRTZWMpKTtcclxuICB9LCAxMDAwKTtcclxufTtcclxuXHJcbmNvbnN0IGV2ZW50c0luaXQgPSAoKSA9PiB7XHJcbiAgJChcIi5wbGF5ZXJfX3N0YXJ0XCIpLm9uKFwiY2xpY2tcIiwgZSA9PiB7XHJcbiAgICBlLnByZXZlbnREZWZhdWx0KCk7XHJcbiAgICBjb25zdCBidG4gPSAkKGUuY3VycmVudFRhcmdldCk7XHJcblxyXG4gICAgaWYgKGJ0bi5oYXNDbGFzcyhcInBhdXNlZFwiKSkge1xyXG4gICAgICBwbGF5ZXIucGF1c2VWaWRlbygpO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgcGxheWVyLnBsYXlWaWRlbygpO1xyXG4gICAgfVxyXG4gIH0pO1xyXG5cclxuICAkKFwiLnBsYXllcl9fcGxheWJhY2tcIikub24oXCJjbGlja1wiLCBlID0+IHtcclxuICAgIGNvbnN0IGJhciA9ICQoZS5jdXJyZW50VGFyZ2V0KTtcclxuICAgIGNvbnN0IG5ld0J1dHRvblBvc2l0aW9uID0gZS5wYWdlWCAtIGJhci5vZmZzZXQoKS5sZWZ0O1xyXG4gICAgY29uc3QgYnV0dG9uUG9zUGVyY2VudCA9IChuZXdCdXR0b25Qb3NpdGlvbiAvIGJhci53aWR0aCgpKSAqIDEwMDtcclxuICAgIGNvbnN0IG5ld1BsYXllclRpbWVTZWMgPSAocGxheWVyLmdldER1cmF0aW9uKCkgLyAxMDApICogYnV0dG9uUG9zUGVyY2VudDtcclxuXHJcbiAgICAkKFwiLnBsYXllcl9fcGxheWJhY2stYnV0dG9uXCIpLmNzcyh7XHJcbiAgICAgIGxlZnQ6IGAke2J1dHRvblBvc1BlcmNlbnR9JWBcclxuICAgIH0pO1xyXG5cclxuICAgIHBsYXllci5zZWVrVG8obmV3UGxheWVyVGltZVNlYyk7XHJcbiAgfSk7XHJcblxyXG4gICQoXCIucGxheWVyX19zcGxhc2hcIikub24oXCJjbGlja1wiLCBlID0+IHtcclxuICAgIHBsYXllci5wbGF5VmlkZW8oKTtcclxuICB9KTtcclxufTtcclxuXHJcbmNvbnN0IG9uUGxheWVyU3RhdGVDaGFuZ2UgPSBldmVudCA9PiB7XHJcbiAgY29uc3QgcGxheWVyQnV0dG9uID0gJChcIi5wbGF5ZXJfX3N0YXJ0XCIpO1xyXG4gIC8qXHJcbiAgLTEgKNCy0L7RgdC/0YDQvtC40LfQstC10LTQtdC90LjQtSDQstC40LTQtdC+INC90LUg0L3QsNGH0LDRgtC+KVxyXG4gIDAgKNCy0L7RgdC/0YDQvtC40LfQstC10LTQtdC90LjQtSDQstC40LTQtdC+INC30LDQstC10YDRiNC10L3QvilcclxuICAxICjQstC+0YHQv9GA0L7QuNC30LLQtdC00LXQvdC40LUpXHJcbiAgMiAo0L/QsNGD0LfQsClcclxuICAzICjQsdGD0YTQtdGA0LjQt9Cw0YbQuNGPKVxyXG4gIDUgKNCy0LjQtNC10L4g0L/QvtC00LDRjtGCINGA0LXQv9C70LjQutC4KS5cclxuICAgKi9cclxuICBzd2l0Y2ggKGV2ZW50LmRhdGEpIHtcclxuICAgIGNhc2UgMTogXHJcbiAgICAgICQoJy5wbGF5ZXJfX3dyYXBwZXInKS5hZGRDbGFzcygnYWN0aXZlJyk7XHJcbiAgICAgIHBsYXllckJ1dHRvbi5hZGRDbGFzcyhcInBhdXNlZFwiKTtcclxuICAgICAgYnJlYWs7XHJcbiAgICBjYXNlIDI6IFxyXG4gICAgICBwbGF5ZXJCdXR0b24ucmVtb3ZlQ2xhc3MoXCJwYXVzZWRcIik7XHJcbiAgICAgIGJyZWFrO1xyXG4gIH1cclxufTtcclxuXHJcbmZ1bmN0aW9uIG9uWW91VHViZUlmcmFtZUFQSVJlYWR5KCkge1xyXG4gIHBsYXllciA9IG5ldyBZVC5QbGF5ZXIoXCJ5dC1wbGF5ZXJcIiwge1xyXG4gICAgaGVpZ2h0OiBcIjQwNVwiLFxyXG4gICAgd2lkdGg6IFwiNjYwXCIsXHJcbiAgICB2aWRlb0lkOiBcIjdBa2JVZlpqUzVrXCIsXHJcbiAgICBldmVudHM6IHtcclxuICAgICAgb25SZWFkeTogb25QbGF5ZXJSZWFkeSxcclxuICAgICAgb25TdGF0ZUNoYW5nZTogb25QbGF5ZXJTdGF0ZUNoYW5nZVxyXG4gICAgfSxcclxuICAgIHBsYXllclZhcnM6IHtcclxuICAgICAgY29udHJvbHM6IDAsXHJcbiAgICAgIGRpc2FibGVrYjogMCxcclxuICAgICAgc2hvd2luZm86IDAsXHJcbiAgICAgIHJlbDogMCxcclxuICAgICAgYXV0b3BsYXk6IDAsXHJcbiAgICAgIG1vZGVzdGJyYW5kaW5nOiAwXHJcbiAgICB9XHJcbiAgfSk7XHJcbn1cclxuXHJcbmV2ZW50c0luaXQoKTsiXX0=
